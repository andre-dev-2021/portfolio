---
title: "An√°lise de Cota√ß√µes do D√≥lar com Python e API do Banco Central"
description: "Aprenda a extrair dados de APIs e criar gr√°ficos interativos com Plotly."
author: "Andr√© Pereira"
date: "11/10/2025"
date-modified: "11/16/2025"
categories:
    - python
    - an√°lise de dados
    - API
    - plotly
    - pandas
    - requests
image: dolar.jpg
---

Extrair dados de APIs e elaborar gr√°ficos s√£o tarefas comuns em an√°lise de dados, e esse projeto te ajudar√° a entender um pouco mais sobre esse processo.

## API do Banco Central

O Banco Central do Brasil disponibiliza uma API gratuita, sem necessidade de autentica√ß√£o, que pode ser usada em diversos projetos.

Neste exemplo, utilizaremos o endpoint */CotacaoDolarPeriodo*

[üìéDocumenta√ß√£o da API](https://olinda.bcb.gov.br/olinda/servico/PTAX/versao/v1/swagger-ui3#/)

## Bibliotecas utilizadas:

* Plotly
* Pandas
* Requests

Este projeto foi desenvolvido em **Python 3**

## 1. Encontrando o primeiro e ultimo dia do m√™s

Como iremos informar apenas o m√™s e o ano (formato: mmYYYY), e nem todos os meses possuem o mesmo n√∫mero de dias, precisamos criar uma fun√ß√£o que encontre o primeiro e o √∫ltimo dia do per√≠odo informado.

Para isso, utilizaremos as bibliotecas **calendar** e **datetime**, que j√° v√™m inclu√≠das no Python 3.

```python
import calendar
from datetime import datetime as dt

def encontrar_periodo(mmYYYY):
    primeiro = dt.strptime(mmYYYY, "%m%Y")
    ultimo = primeiro.replace(day = calendar.monthrange(primeiro.year, primeiro.month)[1])

    primeiro = dt.strftime(primeiro, "%m-%d-%Y")
    ultimo = dt.strftime(ultimo, "%m-%d-%Y")

    return primeiro, ultimo

# Para este exemplo utilizaremos o m√™s de Setembro/2018
dataInicial, dataFinal = encontrar_periodo("092018")
```

## 2. Recebendo os dados da API

Com as datas j√° formatadas (mm-dd-YYYY), podemos buscar os dados atrav√©s de uma requisi√ß√£o GET e organiz√°-los em listas.

```python

import requests as rq

def cotacao_mes(dataInicial, dataFinal):
    res = rq.get(f"https://olinda.bcb.gov.br/olinda/servico/PTAX/versao/v1/odata/CotacaoDolarPeriodo(dataInicial=@dataInicial,dataFinalCotacao=@dataFinalCotacao)?@dataInicial='{dataInicial}'&@dataFinalCotacao='{dataFinal}'&$top=100&$format=json", timeout=10)

    try:
        return res.json()['value']
    except:
        return f"Erro: {res.status_code} - {res.text[:1000]}"

dados = cotacao_mes(dataInicial, dataFinal)

preco_compra = [i['cotacaoCompra'] for i in dados]
preco_venda = [i['cotacaoVenda'] for i in dados]
dia = [int(i['dataHoraCotacao'][8:10]) for i in dados]
```

## 3. Preenchendo lacunas

Utilizando a API do Banco Central podemos perceber uma limita√ß√£o: n√£o temos informa√ß√µes sobre as cota√ß√µes em fins de semana e feriados. Felizmente isso √© bem f√°cil de resolver, vamos somente duplicar valores do ultimo dia v√°lido para utilizar para este dia.

```python
# Duplica dados para os dias que faltam
mes = set(dia)
for i in range(1, 31):
    if i not in mes:
        j = i - 1
        while j not in mes:
            j = j - 1
        dia.append(i)
        preco_compra.append(preco_compra[j-1])
        preco_venda.append(preco_compra[j-1])
```

## 4. Montando um DataFrame

Antes de gerar o gr√°fico, precisamos organizar os dados em um DataFrame para facilitar a manipula√ß√£o.

```python

import pandas as pd

df_compra = pd.DataFrame({
    "preco": preco_compra,
    "tipo": "Compra",
    "dia": dia
})

df_venda = pd.DataFrame({
    "preco": preco_venda,
    "tipo": "Venda",
    "dia": dia
})

df = pd.concat([df_compra, df_venda], ignore_index=True)
```

## 5. Criando nosso gr√°fico

Agora podemos visualizar as cota√ß√µes com o m√≥dulo *express* da biblioteca **plotly**.

Veja como √© simples criar um gr√°fico de linha interativo:

```python
import plotly.express as px

fig = px.line(df, x="dia", y="preco", color='tipo')
fig.update_layout(
    title="Gr√°fico: Cota√ß√µes do d√≥lar no m√™s de Setembro/2018",
    xaxis_title="Dia",
    yaxis_title="Pre√ßo")
fig.write_html("grafico.html")
```

## 6. Observando o resultado

Com tudo pronto, basta rodar o arquivo Python:

```bash
python script.py
```

O resultado ser√° um gr√°fico interativo com as cota√ß√µes do m√™s especificado.

```{python}

#| label: plot_cotacoes
#| fig-cap: "Gr√°fico com cota√ß√µes do m√™s de Setembro/2018"

import calendar
import requests as rq
import pandas as pd
import plotly.express as px
from datetime import datetime as dt

def encontrar_periodo(mmYYYY):
    primeiro = dt.strptime(mmYYYY, "%m%Y")
    ultimo = primeiro.replace(day = calendar.monthrange(primeiro.year, primeiro.month)[1])

    primeiro = dt.strftime(primeiro, "%m-%d-%Y")
    ultimo = dt.strftime(ultimo, "%m-%d-%Y")

    return primeiro, ultimo

def cotacao_mes(dataInicial, dataFinal):
    res = rq.get(f"https://olinda.bcb.gov.br/olinda/servico/PTAX/versao/v1/odata/CotacaoDolarPeriodo(dataInicial=@dataInicial,dataFinalCotacao=@dataFinalCotacao)?@dataInicial='{dataInicial}'&@dataFinalCotacao='{dataFinal}'&$top=100&$format=json", timeout=10)

    try:
        return res.json()['value']
    except:
        return f"Erro: {res.status_code} - {res.text[:1000]}"

# Extra√ß√£o dos dados
dataInicial, dataFinal = encontrar_periodo("092018")
dados = cotacao_mes(dataInicial, dataFinal)

preco_compra = [i['cotacaoCompra'] for i in dados]
preco_venda = [i['cotacaoVenda'] for i in dados]
dia = [int(i['dataHoraCotacao'][8:10]) for i in dados]

# Duplica dados para os dias que faltam
mes = set(dia)
for i in range(1, 31):
    if i not in mes:
        j = i - 1
        while j not in mes:
            j = j - 1
        dia.append(i)
        preco_compra.append(preco_compra[j-1])
        preco_venda.append(preco_compra[j-1])

# Formata√ß√£o em DataFrames
df_compra = pd.DataFrame({
    "preco": preco_compra,
    "tipo": "Compra",
    "dia": sorted(dia)
})

df_venda = pd.DataFrame({
    "preco": preco_venda,
    "tipo": "Venda",
    "dia": sorted(dia)
})

df = pd.concat([df_compra, df_venda], ignore_index=True)

# Exibi√ß√£o em gr√°fico de linha
fig = px.line(df, x="dia", y="preco", color='tipo')
fig.update_layout(
    title="Gr√°fico: Cota√ß√µes do d√≥lar no m√™s de Setembro/2018",
    xaxis_title="Dia",
    yaxis_title="Pre√ßo")
fig.write_html("grafico.html")
```
<iframe
    src="grafico.html"
    height="600"
    width="100%"
    >
</iframe>

## Conclus√£o

Com poucas linhas de c√≥digo, voc√™ aprendeu a:

* extrair dados de uma API,
* tratar e organizar as informa√ß√µes com **pandas**
* e criar visualiza√ß√µes com **plotly**

Esse fluxo √© uma excelente base para projetos de an√°lise de dados automatizada com Python.