---
title: "An√°lise de Cota√ß√µes do D√≥lar com Python e API do Banco Central"
description: "Aprenda a extrair dados de APIs e criar gr√°ficos interativos com Plotly."
author: "Andr√© Pereira"
date: "11/10/2025"
date-modified: "11/19/2025"
categories:
    - python
    - an√°lise de dados
    - API
    - plotly
    - pandas
    - requests
image: dolar.jpg
---

Extrair dados de APIs e elaborar gr√°ficos s√£o tarefas comuns em an√°lise de dados, e esse projeto te ajudar√° a entender um pouco mais sobre esse processo.

## API do Banco Central

O Banco Central do Brasil disponibiliza uma API gratuita, sem necessidade de autentica√ß√£o, que pode ser usada em diversos projetos.

[üìéDocumenta√ß√£o da API](https://olinda.bcb.gov.br/olinda/servico/PTAX/versao/v1/swagger-ui3#/)

## Bibliotecas utilizadas:

* Plotly
* Pandas
* Requests

Este projeto foi desenvolvido em **Python 3**

## 1. Encontrando o primeiro e ultimo dia do m√™s

Como iremos informar apenas o m√™s e o ano (formato: mmYYYY), e nem todos os meses possuem o mesmo n√∫mero de dias, precisamos criar uma fun√ß√£o que encontre o primeiro e o √∫ltimo dia do per√≠odo informado.

Para isso, utilizaremos as bibliotecas **calendar** e **datetime**, que j√° v√™m inclu√≠das no Python 3.

```python
import calendar
from datetime import datetime

def periodo(data):
    primeiro_dia = datetime.strptime(data, "%m%Y")
    ultimo_dia = primeiro_dia.replace(day = calendar.monthrange(primeiro_dia.year, primeiro_dia.month)[1])
    primeiro_dia = datetime.strftime(primeiro_dia, "%m%d%Y")
    ultimo_dia = datetime.strftime(ultimo_dia, "%m%d%Y")

    return primeiro_dia, ultimo_dia
```

## 2. Recebendo os dados da API

Com as datas j√° formatadas (mmddYYYY), podemos buscar os dados atrav√©s de uma requisi√ß√£o GET para o endpoint e /CotacaoDolarPeriodo organiz√°-los em listas.

```python

import requests

def cotar(primeiro_dia, ultimo_dia):
    url = fr"https://olinda.bcb.gov.br/olinda/servico/PTAX/versao/v1/odata/CotacaoDolarPeriodo(dataInicial=@dataInicial,dataFinalCotacao=@dataFinalCotacao)?@dataInicial='{primeiro_dia}'&@dataFinalCotacao='{ultimo_dia}'&$top=100&$format=json"

    res = requests.get(url, timeout=10)
    data = res.json()['value']
    return data

cotacao = cotar(primeiro_dia, ultimo_dia)

dados_compra = [i['cotacaoCompra'] for i in cotacao]
dados_venda = [i['cotacaoVenda'] for i in cotacao]
datas = [int(i['dataHoraCotacao'][8:10]) for i in cotacao]
```

## 3. Preenchendo lacunas

Utilizando a API do Banco Central podemos perceber uma limita√ß√£o: n√£o temos informa√ß√µes sobre as cota√ß√µes em fins de semana e feriados. Felizmente isso √© bem f√°cil de resolver, vamos utilizar outro endpoint, /CotacaoDolarDia e buscar recursivamente a ultima cota√ß√£o dispon√≠vel.

```python
def cotacao_dia(data):
    url = fr"https://olinda.bcb.gov.br/olinda/servico/PTAX/versao/v1/odata/CotacaoDolarDia(dataCotacao=@dataCotacao)?@dataCotacao='{data}'&$format=json"
    res = requests.get(url)
    res = res.json()
    if res['value']: 
        return res['value'][0]['cotacaoCompra'], res['value'][0]['cotacaoVenda'], int(res['value'][0]['dataHoraCotacao'][8:10])
    else:
        dia_anterior = datetime.strptime(data, "%m%d%Y") - timedelta(1)
        dia_anterior = datetime.strftime(dia_anterior, "%m%d%Y")
        return cotacao_dia(dia_anterior)

mes = [i for i in range(1, 31)]
dias_faltantes = set(mes) - set(datas)

for i in dias_faltantes:
    if i < 10:
        i = '0' + f'{i}'
    compra, venda, dia = cotacao_dia(f'09{i}2018')
    dados_compra.append(compra)
    dados_venda.append(venda)
    datas.append(int(i))
```

## 4. Montando um DataFrame

Antes de gerar o gr√°fico, precisamos organizar os dados em um DataFrame para facilitar a manipula√ß√£o.

```python

import pandas as pd

df_compra = pd.DataFrame({
    "preco": preco_compra,
    "tipo": "Compra",
    "dia": dia
})

df_venda = pd.DataFrame({
    "preco": preco_venda,
    "tipo": "Venda",
    "dia": dia
})

df = pd.concat([df_compra, df_venda], ignore_index=True)
```

## 5. Criando nosso gr√°fico

Agora podemos visualizar as cota√ß√µes com o m√≥dulo *express* da biblioteca **plotly**.

Veja como √© simples criar um gr√°fico de linha interativo:

```python
import plotly.express as px

fig = px.line(df, x="dia", y="preco", color='tipo')
fig.update_layout(
    title="Gr√°fico: Cota√ß√µes do d√≥lar no m√™s de Setembro/2018",
    xaxis_title="Dia",
    yaxis_title="Pre√ßo")
fig.show()
```

## 6. Observando o resultado

Com tudo pronto, basta rodar o arquivo Python:

```bash
python script.py
```

O resultado ser√° um gr√°fico interativo com as cota√ß√µes do m√™s especificado.

```{python}
#| label: plot_cotacoes
#| fig-cap: "Gr√°fico com cota√ß√µes do m√™s de Setembro/2018"

import requests
import pandas as pd
import plotly.express as px
import calendar
from datetime import datetime, timedelta

def periodo(data):
    primeiro_dia = datetime.strptime(data, "%m%Y")
    ultimo_dia = primeiro_dia.replace(day = calendar.monthrange(primeiro_dia.year, primeiro_dia.month)[1])
    primeiro_dia = datetime.strftime(primeiro_dia, "%m%d%Y")
    ultimo_dia = datetime.strftime(ultimo_dia, "%m%d%Y")

    return primeiro_dia, ultimo_dia

def cotacao_mes(primeiro_dia, ultimo_dia):
    url = fr"https://olinda.bcb.gov.br/olinda/servico/PTAX/versao/v1/odata/CotacaoDolarPeriodo(dataInicial=@dataInicial,dataFinalCotacao=@dataFinalCotacao)?@dataInicial='{primeiro_dia}'&@dataFinalCotacao='{ultimo_dia}'&$top=100&$format=json"

    res = requests.get(url, timeout=10)
    data = res.json()['value']
    return data

def cotacao_dia(data):
    url = fr"https://olinda.bcb.gov.br/olinda/servico/PTAX/versao/v1/odata/CotacaoDolarDia(dataCotacao=@dataCotacao)?@dataCotacao='{data}'&$format=json"
    res = requests.get(url)
    res = res.json()
    if res['value']: 
        return res['value'][0]['cotacaoCompra'], res['value'][0]['cotacaoVenda'], int(res['value'][0]['dataHoraCotacao'][8:10])
    else:
        dia_anterior = datetime.strptime(data, "%m%d%Y") - timedelta(1)
        dia_anterior = datetime.strftime(dia_anterior, "%m%d%Y")
        return cotacao_dia(dia_anterior)


data = "092018"
primeiro_dia, ultimo_dia = periodo(data)
cotacao = cotacao_mes(primeiro_dia, ultimo_dia)

dados_compra = [i['cotacaoCompra'] for i in cotacao]
dados_venda = [i['cotacaoVenda'] for i in cotacao]
datas = [int(i['dataHoraCotacao'][8:10]) for i in cotacao]

mes = [i for i in range(1, 31)]
dias_faltantes = set(mes) - set(datas)

for i in dias_faltantes:
    if i < 10:
        i = '0' + f'{i}'
    compra, venda, dia = cotacao_dia(f'09{i}2018')
    dados_compra.append(compra)
    dados_venda.append(venda)
    datas.append(int(i))

df_compra = pd.DataFrame({
    "preco": dados_compra,
    "tipo": "Compra",
    "dia": sorted(datas)
})

df_venda = pd.DataFrame({
    "preco": dados_venda,
    "tipo": "Venda",
    "dia": sorted(datas)
})

df = pd.concat([df_compra, df_venda], ignore_index=True)
fig = px.line(df, x="dia", y="preco", color='tipo')
fig.update_layout(
    title="Gr√°fico de cota√ß√µes de Setembro/2018",
    xaxis_title="Dia",
    yaxis_title="Pre√ßo"
)
fig.show()
```

## Conclus√£o

Com poucas linhas de c√≥digo, voc√™ aprendeu a:

* extrair dados de uma API,
* tratar e organizar as informa√ß√µes com **pandas**
* e criar visualiza√ß√µes com **plotly**
